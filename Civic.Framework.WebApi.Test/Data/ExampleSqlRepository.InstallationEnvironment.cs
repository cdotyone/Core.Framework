//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated from a template.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#pragma warning disable 1591 // this is to supress no xml comments in public members warnings 

using System;
using System.Collections.Generic;
using System.Data;
using System.Diagnostics;
using System.Security.Claims;
using Civic.Core.Data;
using Civic.Framework.WebApi.Configuration;
using Civic.Framework.WebApi.Test.Entities;
using Civic.Framework.WebApi.Test.Interfaces;

using InstallationEnvironmentEntity = Civic.Framework.WebApi.Test.Entities.InstallationEnvironment;
namespace Civic.Framework.WebApi.Test.Data
{
    public partial class ExampleSqlRepository
    {
    	public InstallationEnvironmentEntity GetInstallationEnvironment(IEntityRequestContext context,  String environmentCode)
    	{
    		using(var database = SqlQuery.GetConnection("Example", EntityOperationType.Get, null ,context)) {
    
    			Debug.Assert(database!=null);
    
       			var retval = Container.GetInstance<InstallationEnvironmentEntity>();
    
    			using (var command = database.CreateStoredProcCommand("dbo","usp_InstallationEnvironmentGet"))
    			{
    		        var info = InstallationEnvironmentEntity.Info;
    		        if (!info.UseProcedureGet)
    		        {
    		            return SqlQuery.Get(Container, context.Who,  environmentCode, InstallationEnvironmentEntity.Info, database) as InstallationEnvironmentEntity;
                    }
    
    				command.AddInParameter("@environmentCode", environmentCode);
    				
    				command.ExecuteReader(dataReader =>
    					{
    						if (SqlQuery.PopulateEntity(context, retval, dataReader))
    						{
    							retval.EnvironmentCode = environmentCode;
    												}
    						else retval = null;
    					});
    			}
    			return retval;
    		}
    	}
    
    	public List<InstallationEnvironmentEntity> GetPagedInstallationEnvironment(IEntityRequestContext context, int skip, ref int count, bool retCount, string filterBy, string orderBy)
    	{ 
    		using(var database = SqlQuery.GetConnection("Example", EntityOperationType.Get, null ,context)) {
    
    			Debug.Assert(database!=null);
    
    			var list = new List<InstallationEnvironmentEntity>();
    
    		    var info = InstallationEnvironmentEntity.Info;
    		    if (!info.UseProcedureGet)
    		    {
    		        var entityList = SqlQuery.GetPaged(Container, context.Who, InstallationEnvironmentEntity.Info, skip, ref count, retCount, filterBy, orderBy, database);
    		        foreach (var entity in entityList)
    		        {
    		            list.Add(entity as InstallationEnvironmentEntity);
    		        }
    
    		        return list;
    		    }
    
    			using (var command = database.CreateStoredProcCommand("dbo","usp_InstallationEnvironmentGetFiltered"))
    			{
    				command.AddInParameter("@skip", skip);			
    				command.AddInParameter("@retcount", retCount);
    				if(!string.IsNullOrEmpty(filterBy)) command.AddInParameter("@filterBy", filterBy);
    				command.AddInParameter("@orderBy", orderBy);
        			command.AddParameter("@count", ParameterDirection.InputOutput, count);
    			
    				command.ExecuteReader(dataReader =>
    					{
       						var item = Container.GetInstance<InstallationEnvironmentEntity>();
    						while(SqlQuery.PopulateEntity(context, item, dataReader))
    						{
    							list.Add(item);
       							item = Container.GetInstance<InstallationEnvironmentEntity>();
    						} 
    					});
    
    				if (retCount) count = int.Parse(command.GetOutParameter("@count").Value.ToString());
    			}
    			return list;
    		}
    	}
    
    	public void AddInstallationEnvironment(IEntityRequestContext context, InstallationEnvironmentEntity entity)
    	{ 
    		using(var database = SqlQuery.GetConnection("Example", EntityOperationType.Add, entity ,context)) {
    
    			Debug.Assert(database!=null);
    
    			using (var command = database.CreateStoredProcCommand("dbo","usp_InstallationEnvironmentAdd"))
    			{
    				buildInstallationEnvironmentCommandParameters(context, entity, command, true );
    				command.ExecuteNonQuery();
    			}
    
    		    context.Operations.Add(new SqlOperation
    		    {
    		        Type = EntityOperationType.Modify,
    		        DbCode = database.DBCode,
    		        Connection = database,
    		        Entity = entity
    		    });
    		}
    	}
    
    	public void ModifyInstallationEnvironment(IEntityRequestContext context, InstallationEnvironmentEntity before, InstallationEnvironmentEntity after)
    	{ 
    		using(var database = SqlQuery.GetConnection("Example", EntityOperationType.Modify, before, context)) {
    			Debug.Assert(database!=null);
    
    			context.Operations.Add(new SqlOperation {
    			});
    
    			using (var command = database.CreateStoredProcCommand("dbo","usp_InstallationEnvironmentModify"))
    			{
    				buildInstallationEnvironmentCommandParameters(context, before, command, false );
    				command.ExecuteNonQuery();
    			}
    
    		    context.Operations.Add(new SqlOperation
    		    {
                    Type = EntityOperationType.Modify,
                    DbCode = database.DBCode,
                    Connection = database,
                    Entity = before
    		    });
    		}
    	}
    
    	public void RemoveInstallationEnvironment(IEntityRequestContext context, InstallationEnvironmentEntity entity )
    	{
    		using(var database = SqlQuery.GetConnection("Example", EntityOperationType.Remove, entity, context)) {
    
    			Debug.Assert(database!=null);
    
    			using (var command = database.CreateStoredProcCommand("dbo","usp_InstallationEnvironmentRemove"))
    			{
    				buildInstallationEnvironmentCommandParameters(context, entity, command, false );
    				command.ExecuteNonQuery();
    			}
    
    		    context.Operations.Add(new SqlOperation
    		    {
    		        Type = EntityOperationType.Remove,
    		        DbCode = database.DBCode,
    		        Connection = database,
    		        Entity = entity
    		    });
    		}
    	}
    
    	static void buildInstallationEnvironmentCommandParameters(IEntityRequestContext context, InstallationEnvironmentEntity entity, IDBCommand command, bool addRecord )
    	{ 
            Debug.Assert(command!=null);
       		if(addRecord) command.AddParameter("@environmentcode", ParameterDirection.InputOutput,  T4Config.CheckUpperCase("dbo","installationenvironment","environmentcode",entity.EnvironmentCode));
    		else command.AddInParameter("@environmentcode", T4Config.CheckUpperCase("dbo","installationenvironment","environmentcode",entity.EnvironmentCode));
    		command.AddInParameter("@name", T4Config.CheckUpperCase("dbo","installationenvironment","name",entity.Name));
    		command.AddInParameter("@description", T4Config.CheckUpperCase("dbo","installationenvironment","description",entity.Description, false));
    		command.AddInParameter("@isvisible", T4Config.CheckUpperCase("dbo","installationenvironment","isvisible",entity.IsVisible));
    	}
    }
}

